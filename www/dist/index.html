<!doctype html>
<head>
</head>
<body>
	<h1>Detect </h1>
	<button onclick="start();">Start</button>
	<button onclick="stop();">Stop</button>
	<a id="downloadAnchor" href="#">Download s</a>
	<p id="answer" />
	<script>
		chunks = []
		userMedia = navigator.mediaDevices.getUserMedia({ audio: true, video: false });
		console.log(userMedia);
		var rec = null;
		userMedia.then(function(stream) {
			rec = new MediaRecorder(stream);
			console.log(rec)
			rec.ondataavailable = function(e) { console.log(e.data); saveData(e); };
		});
		
		function start() {
			rec.start();
		}

		function stop() {
			rec.stop();
		}

		function saveData(e) {
			console.log(e.data)
			//var blob = new Blob(e.Data, { type: "audio/wav" });
			var audioUrl = window.URL.createObjectURL(e.data);
			downloadAnchor = document.getElementById('downloadAnchor');
			downloadAnchor.href = audioUrl;
			const CLIENT_ID = '610201394110-9hk26numij4kcfm1rek6imlahvh10o9n.apps.googleusercontent.com';
			var driveRequest = new XMLHttpRequest();
			driveRequest.open("POST", "https://www.googleapis.com/upload/drive/v3/files");
			
			var request = new XMLHttpRequest();
			request.onload = function() {
				answer = document.getElementById('answer');
				switch(request.responseText) {
					case '1': answer.innerHtml = 'female'; break;
					case '2': answer.innerHtml = 'male'; break;
				}
			}
			request.open("POST", "/recognize", true);
			request.setRequestHeader("Content-Type", "audio/ogg");
			request.send(e.data);
		}
	</script>
</body>
