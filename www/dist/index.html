<!doctype html>
<head>
</head>
<body>
	<h1>Detect </h1>
	<button onclick="start();">Start</button>
	<button onclick="stop();">Stop</button>
	<a id="downloadAnchor" href="#">Download s</a>
	<p id="answer" />
	<script>
		chunks = []
		userMedia = navigator.mediaDevices.getUserMedia({ audio: true, video: false });
		console.log(userMedia);
		var rec = null;
		userMedia.then(function(stream) {
			rec = new MediaRecorder(stream);
			console.log(rec)
			rec.ondataavailable = function(e) { console.log(e.data); saveData(e); };
		});
		
		function start() {
			rec.start();
		}

		function stop() {
			rec.stop();
		}
		file = null;
		blo = null;
		function saveData(e) {
			blo = e.data;
			console.log(e.data)
			//var blob = new Blob(e.Data, { type: "audio/wav" });
			var audioUrl = window.URL.createObjectURL(e.data);
			downloadAnchor = document.getElementById('downloadAnchor');
			downloadAnchor.href = audioUrl;
			file = new File([e.data], 'test.wav');
			var formData = new FormData();
			formData.append("file", file);
			var fileRequest = new XMLHttpRequest();
			fileRequest.onload = function() {
				var fileUrl = JSON.parse(fileRequest.responseText).link;
				var request = new XMLHttpRequest();
				request.onload = function() {
					answer = document.getElementById('answer');
					switch(request.responseText) {
						case '1': answer.innerHtml = 'female'; break;
						case '2': answer.innerHtml = 'male'; break;
					}
				}
				request.send(fileRequest.responseText);
				request.send(fileUrl);
			}
			fileRequest.open("POST", "https://file.io", true);
			fileRequest.send(formData);
		}
	</script>
</body>
